<krpano>
	<include url="./plugins/showtext.xml" />
  <!-- 引入皮肤 -->
  <include url="./skin/videointerface.xml" />
	<!-- 
	<image>
		<sphere url='../imgs/preview1.jpeg' />
	</image> -->

	<scene name="videoscene" keep="true" autoload="true">
		<image>
			<sphere url="plugin:video" />
		</image>
	</scene>

	<scene name="imgscene" keep="true">
		<image>
			<sphere url="./imgs/preview1.jpeg" />
		</image>
	</scene>

	<scene name="noscene" keep="true">
		<image>
			<sphere />
		</image>
	</scene>

  <plugin name="video"
		        pausedonstart="true"
		        loop="true"
		        volume="1.0"
		        onloaded="add_video_sources();"
		        />

  <view hlookat="0" vlookat="0" fovtype="DFOV" fov="130" fovmin="75" fovmax="150" distortion="0.0" />

	<!-- 
		<area mode="border" left="0" top="0" right="0" bottom="0" cliplayers="true" /> 
	-->


	<!-- <layer name="mytext1" type="text" x="10" y="10" html="Text...[br][b]Bold Text...[/b]" css="font-family:Arial; font-size:16px; color:#000000;writing-mode: vertical-lr; " ondown="draghotspot();" /> -->


	<!-- <hotspot name="mytext" type="text" ath="0" atv="0" width="200" edge="center" distorted="true" renderer="webgl" html="这是一段测试文字" css="font-family:Arial; font-size:16px; color:#000000;writing-mode: vertical-lr;" onloaded="add_all_the_time_tooltip();" bgborder="10px #00ff00" ondown="draghotspot();" onhover="showtext(提示文字,STYLE12);" /> -->


	<!-- <plugin name="hotspot_pos_info" type="text" html="drag the hotspots..." padding="8" x="10" y="10" width="200" enabled="true" distorted="true" />
-->
	<!-- <layer name="hot1" type="image" url="/kplayer/imgs/beforeTrigger.png" width="100" height="100" x="100.0" y="110.0" zoom="true" distorted="true" onclick="looktohotspot(get(name),90); " text="xxxxxxxaaaaaaaaaccccccc" /> -->


	<!-- <view hlookat="0.0" vlookat="0.0" fov="90.0" fovmin="1.0" fovmax="179.0" maxpixelzoom="" /> -->

	<!-- 加入一个按钮，控制音乐播放暂停 -->
	<!-- <plugin name="snd" url="../imgs/img1.jpeg" align="leftbottom" x="100" y="100" scale="0.5" onover="tween(alpha,1);" onout="tween(alpha,0.25);" crop="0|0|50|50" onclick="pausesoundtoggle(bgsnd); switch(crop, 0|0|50|50, 0|50|50|50);" /> -->


	<!-- the action for dragging the hotspot - call it once in the ondown event -->
	<action name="draghotspot">
		if(flag == 'hotspot',
		spheretoscreen(ath, atv, hotspotcenterx, hotspotcentery, calc(mouse.stagex LT stagewidth/2 ? 'l' : 'r'));
		sub(drag_adjustx, mouse.stagex, hotspotcenterx);
		sub(drag_adjusty, mouse.stagey, hotspotcentery);
		asyncloop(pressed,
			sub(dx, mouse.stagex, drag_adjustx);
			sub(dy, mouse.stagey, drag_adjusty);
			screentosphere(dx, dy, ath, atv);
		),
		sub(drag_adjustx, mouse.stagex, x);
		sub(drag_adjusty, mouse.stagey, y);
		asyncloop(pressed,
			sub(x, mouse.stagex, drag_adjustx);
			sub(y, mouse.stagey, drag_adjusty);
		);
		);
		trace('name:',name,',flag:',flag);
	</action>


	<!-- 测试互动组件点击图片效果 -->
	<!-- <hotspot name="spottest1" url="../imgs/beforeTrigger.png" beforeTrigger="../imgs/beforeTrigger.png" triggering="../imgs/triggering.png" afterTrigger="../imgs/beforeTrigger.png" onloaded="add_all_the_time_tooltip();" ath="-15" atv="-12" width="110" height="110" ondown="ondownfn" onup="onupfn" /> -->

	<!-- 预览模式下有点击效果，编辑模式下拖动效果 -->
	<action name="ondownfn" scope="global">
		if(ispreview AND flag == 'hotspot',set(hotspot[get(name)].url,get(hotspot[get(name)].triggering)));
		if(ispreview AND flag == 'layer',set(layer[get(name)].url,get(layer[get(name)].triggering)));
		def(b, string, tolower('vCCCAA'));
		if(!ispreview,
			txtadd(tooltipname, 'border_', get(name));
			set(plugin[get(tooltipname)].visible, true);
		<!-- 放弃了，inlinefunction无法调用 -->
		<!-- for(set(i,0), i LT layer.count, inc(i), 
			trace(get(b)); -->
		<!-- trace(contains(get((layer[get(i)].name),'border_')); -->
		<!-- if(indexof((layer[get(i)].name,'border_') !=-1  AND layer[get(i)].name == get(tooltipname),set(layer[get(tooltipname)].visible, true));
			if(indexof((layer[get(i)].name,'border_') !=-1  AND layer[get(i)].name !== get(tooltipname),set(layer[get(tooltipname)].visible, false)); -->
		<!-- ); -->
		draghotspot()
		);
		js(hotspotClick(get(name)));
	</action>

	<action name="onupfn">
		if(ispreview AND flag == 'hotspot',set(hotspot[get(name)].url,get(hotspot[get(name)].beforeTrigger)));
		if(ispreview AND flag == 'layer',set(layer[get(name)].url,get(layer[get(name)].beforeTrigger)));
	</action>

	<!-- 热点上添加文本 -->
	<action name="add_all_the_time_tooltip">
		txtadd(tooltipname, 'tooltip_', get(name));
		callwhen(!plugin[get(tooltipname)],
			addplugin(get(tooltipname));
			if(flag == 'hotspot',
				txtadd(plugin[get(tooltipname)].parent, 'hotspot[', get(name), ']'),
				txtadd(plugin[get(tooltipname)].parent, 'layer[', get(name), ']');
			);
			
			set(plugin[get(tooltipname)].url,'textfield.swf');
			set(plugin[get(tooltipname)].align,center);
			set(plugin[get(tooltipname)].autowidth,true);
			set(plugin[get(tooltipname)].autoheight,true);
			set(plugin[get(tooltipname)].vcenter,true);
			set(plugin[get(tooltipname)].background,false);
			set(plugin[get(tooltipname)].border,false);
			set(plugin[get(tooltipname)].css,'color:#FFFFFF');
			if(text == '' OR text === null,
				copy(plugin[get(tooltipname)].html,scene[get(linkedscene)].title),
				copy(plugin[get(tooltipname)].html,text)
			);
			set(plugin[get(tooltipname)].enabled,false);
			add_all_the_time_border();
		);
	</action>

	<!-- 热点上添加选中框 -->
	<action name="add_all_the_time_border">
		txtadd(tooltipname, 'border_', get(name));
		callwhen(!plugin[get(tooltipname)],
			addplugin(get(tooltipname));
			if(flag == 'hotspot',
				txtadd(plugin[get(tooltipname)].parent, 'hotspot[', get(name), ']'),
				txtadd(plugin[get(tooltipname)].parent, 'layer[', get(name), ']')
			);
			
			set(plugin[get(tooltipname)].url,'./imgs/hotspot_selected_bg.png');
			set(plugin[get(tooltipname)].keep, true);
			set(plugin[get(tooltipname)].visible, false);
			set(plugin[get(tooltipname)].edge, center);
			set(plugin[get(tooltipname)].align, center);
			set(plugin[get(tooltipname)].width, '110%');
			set(plugin[get(tooltipname)].height,'110%');
			set(plugin[get(tooltipname)].enabled,false);
		);
        
	</action>
  <action name="add_video_sources" >
      <!-- videointerface_addsource('video720', './video720.mp4', './imgs/preview1.jpeg'); -->
			videointerface_play('video360');
		</action>
</krpano>